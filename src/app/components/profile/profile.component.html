<div class="profile-page">

  <div *ngIf="isLoading" class="loading-overlay">
    <div class="spinner-border text-warning" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
    <p class="mt-3 fw-medium text-dark">Loading profile...</p>
  </div>


  <div *ngIf="errorMessage && !isLoading" class="error-container">
    <div class="alert alert-danger" role="alert">
      <i class="fas fa-exclamation-triangle me-2"></i>
      {{ errorMessage }}
    </div>
  </div>


  <div *ngIf="!isLoading && !errorMessage && lawyer" class="profile-content">
    <section class="profile-header">
      <img [src]="avatarUrl" alt="{{ lawyer.name }} photo" class="profile-avatar" />
      <h1>{{ lawyer.name }}</h1>
      <div class="meta">
        <span>{{ lawyer.title || 'Business Law' }}</span>
        <span class="divider">|</span>
        <span>Experience: {{ lawyer.experience }} yrs</span>
      </div>
      <div class="actions">
        <button class="btn main-btn" (click)="onFollowClick()">
          <i class="fas fa-plus me-1"></i> Follow
        </button>
        <button class="btn consult-btn" (click)="onConsultationClick()">
          Request Consultation
        </button>
      </div>
    </section>

    <div class="container">
    
      <section class="bio-section">
        <h2>BIO</h2>
        <p>{{ lawyer.bio }}</p>
      </section>

      <div class="row">
      
        <div class="col-lg-6">
        
          <section class="rating-overview">
            <h2>RATING OVERVIEW</h2>
            <div class="chart-wrapper">
              <canvas #reviewChart></canvas>
            </div>
            <div class="rating-bars">
              <ng-container *ngFor="let s of STAR_LEVELS">
                <div class="rating-row">
                  <div class="label">{{ s }}★</div>
                  <div class="bar">
                    <div
                      class="progress-bar"
                      [style.width.%]="getRatingPercent(s)"
                    ></div>
                  </div>
                  <div class="percent">{{ getRatingPercent(s) }}%</div>
                </div>
              </ng-container>
            </div>
          </section>

     
          <section class="schedule">
            <h2>SCHEDULE</h2>
            <table>
              <tr *ngFor="let item of schedule; trackBy: trackByScheduleDay">
                <td>{{ item.day }}</td>
                <td>
                  <ng-container *ngIf="item.timeRanges.length; else na">
                    <span class="badge" *ngFor="let range of item.timeRanges">
                      {{ range.start }} - {{ range.end }}
                    </span>
                  </ng-container>
                  <ng-template #na>
                    <span class="unavail">Unavailable</span>
                  </ng-template>
                </td>
              </tr>
            </table>
          </section>
        </div>

   
        <div class="col-lg-6">
          <section class="reviews">
            <h2>CLIENT REVIEWS</h2>
            <ng-container *ngIf="reviews.length; else noReviews">
              <div
                class="review-card"
                *ngFor="let rev of reviews; trackBy: trackByReviewId"
              >
  
   
 <img [src]="rev.reviewerPhotoUrl || 'assets/client4.jpg'"
     (error)="rev.reviewerPhotoUrl = 'assets/client4.jpg'"
     alt="Client photo"
     class="review-avatar">

           <div class="review-content">
                  <div class="header">
                    <h6>{{ rev.reviewer }}</h6>
                    <small>{{ rev.date }}</small>
                  </div>
                  <div class="stars">
                    <span *ngFor="let _ of getStarArray(rev.rate)">★</span>
                  </div>
                  <p>{{ rev.text }}</p>
                </div>
              </div>
            </ng-container>
            <ng-template #noReviews>
              <div class="no-reviews">
                <i class="fas fa-comment-slash fa-2x"></i>
                <p>No reviews available yet.</p>
              </div>
            </ng-template>
          </section>
        </div>
      </div>
    </div>
  </div>
</div>
